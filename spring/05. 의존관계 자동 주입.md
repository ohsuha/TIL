# 의존 관계 자동 주입
## 다양한 의존 관계 주입 방법
아래의 영역에 @AutoWired 를 붙인다.
- 생성자 주입
  - 생성자를 통해 호출하는 딱 한번만 호출되는 것이 보장된다.
  - 불변, 필수 의존관계에 사용된다.
  - 의존을 하나만 갖게 된다면 @AutoWired 가 필요없다.
- 세터 주입
  - setter 메서드를 만들어 @AutoWired 로 주입해준다.
  - 선택, 변경 가능성이 있는 의존관계에서 사용한다.
- 필드 주입
  - @AutWired private Repository repository 와 같이 사용하지만 이는 안티패턴이다.
  - 외부에서 의존성을 주입할 수 없어 외부에서 변경이 불가능하다.
  - 테스트 코드에서 사용할 수 있다.
- 일반 메서드 주입
    - 일반 메서드에도 여러 필드를 주입 받을 수 있으나 일반적으로 거의 사용하지 않는다.
    - 의존 관계 자동 주입은 스프이 컨테이너가 관리하는 스프링 빈이어야 동작한다. 스프링 빈이 아닌 Member같은 클래스에서 @Autowired 를 적용해도 아무 기능도 동작하지 않는다.

## required 옵션 처리
- 주입할 스프링 빈이 없어도 동작해야 할 때가 있다. @AutoWried(required = false) 를 통해 할 수 있다. 자동 주입할 대상이 없으면 의존 자체가 들어가지 않는다.

## 생성자 주입이 좋은 이유
- 불변
  - 대부분의 의존관계 주입은 한번 일어나면 애플리케이션 종료 시점까지 의존관계를 변경할 일이 없다.
  - 오히려 대부분의 의존관계는 애플리케이션 종료 전까지 변하면 안된다. 불변해야한다.
  - 수정자 주입을 사용하면 public 으로 setter 를 열어둬야하는데 이렇게 되면 실수로 변경할 수 있거나 변경하면 안되는 메서드를 열어 두게 된다.
  - 생성자 주입은 객체 생성할 때 한번만 호출되므로 이후에 호출되는 일이 없다. 따라서 불변하게 설계할 수 있다.
- 누락
  - 프레임워크 없이 순수한 자바 코드 단위 테스트 하는 경우에는 @Autowired가 프레임 워크 안에서 동작시에는 의존관계가 없으면 오류가 발생하지만, 테스트에서는 잘 실행된다.
  - final 을 통해 생성자에서만 설정이 가능하므로 다른 곳에서 설정이 불가능하므로 실수로 누락시 컴파일 에러가 발생해 미리 인지할 수 있다.
- 기본으로 생성자 주입을 사용하고 필수 값이 아닌 경우에는 수정자를 옵션으로 선택하는 식으로 해야한다. 필드 주입은 사용하지 않는게 좋다

## 조회 빈이 2개 이상 : 문제
- interface 를 구현하는 클래스 두개를 모두 빈으로 등록하면 어떻게 될까?
- 이렇게 주입하게 되면 NoUniqueBeanDefinition 에러가 바생하는데 왜냐면 하위 타입으로 지정하는 것은 DIP 를 위배하고 유연성이 떨어진다.
- 완전히 똑같은 타입의 스프링 빈이 2개, 자식이 여러개 있을때는 해결되지 않는다.
- 스프링 빈을 수도으로 등록 할 수 있는 방법도 있지만 다른 방법도 있다.

## @Autowired 필드 명 Qualifier, @Primary
여러개의 빈이 있을때
- @Autowired 의 필드명을 매칭 시키기
  - 필드 명을 구현한 클래스의 이름으로 변경한다.
  - this.DiscountPolicy = rateDiscountPolicy; 
- @Qualifier 를 사용해 매칭 시키기
  - 주로 사용할 구현체에 @Qualifier("fix") 를 사용한다.
  - 의존하는 쪽 생성자에서 매개변수 앞에 @Qualifier("fix) 를 통해 매칭시킨다.
- @Primary 사용하기
  - 우선순위를 정하는 방법으로 여러 구현체가 매칭되면 @Primary 를 작성한 구현체가 우선시된다.

## 조회한 빈이 모두 필요할 때
- 클라이언트가 할인률을 퍼센테이지, 금액으로 선택해야하는 상황이 있을때 전략 패턴을 활용하여 해결할 수 있다.
- List<DiscountPolicy> or Map<String, DiscountPolicy> 와 같은 필드를 생성하면 스프링은 구현된 클래스 전체를 주입해준다.
- Map 으로 생성된 필드에서 map.get("discountPolicy").discount(member, price) 와 같은 식으로 다형성을 통해 다르게 선택할 수 있다.

## 언제 수동 빈 등록을 사용하면 좋을까?
- 기술 지원 객체는 수동 빈으로 등록해서 설정 정보에 바로 나타나게 하는 것이 유지 보수하기 좋다.
- 스프링과 스프링 부트가 자동으로 등록하는 수많은 빈들은 예외이다.
- 비즈니스 로직에서 다형성을 적극 활용할 때. 위의 맵과 같은 식으로 주입을 받을때는 어떤 구현체들이 주입될지 한눈에 보기 어려우므로 이럴 경우 수동으로 등록하거나 특정 패키지에 같이 묶어 두는 것이 좋다.
